<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>لعبة الكتابة الاحترافية</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');
    body {
      font-family: 'Cairo', Arial, sans-serif;
      background: linear-gradient(135deg,#eef1fb 60%,#f8fbff 100%);
      direction: rtl;
      margin: 0; padding: 0;
    }
    .container {
      background: #fff;
      border-radius: 18px;
      max-width: 440px;
      margin: 32px auto;
      padding: 32px 16px 24px;
      box-shadow: 0 2px 25px rgb(160 170 250 /12%);
      text-align: center;
      position: relative;
    }
    h1 {color: #474dff; font-weight:700; margin-bottom: 10px;}
    #level {font-size: 1.18em; color: #21a0c0; margin-bottom: 12px;}
    #quote {
      min-height: 54px;
      background: #f2f6fd;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 10px;
      font-size: 1.18em;
      text-align: right;
      letter-spacing: .7px;
      word-break: break-word;
      transition: .15s;
    }
    #input {
      width: 99%; max-width:420px;
      padding: 13px 7px;
      font-size: 1.07em;
      border-radius: 6px;
      border: 1.4px solid #aacafb;
      margin:8px 0 13px;
      transition:.15s;
    }
    #input:focus {
      border-color: #636efd;
      outline:none;
      box-shadow: 0 0 0 2px #e3e7fe;
    }
    #timer, #score, #stats {
      font-size: 1.13em;
      font-weight: bold;
      margin: 7px 0 2px;
      letter-spacing: .2px;
    }
    #timer {color: #e77c23;}
    #score {color: #16b088;}
    #stats {color: #6745d1;}
    #result {
      font-size: 1.1em;
      margin: 17px 0 8px;
      min-height:24px;
      transition:.17s;
    }
    button {
      display:inline-block;
      margin: 8px 7px 0 0;
      background: linear-gradient(95deg,#474dff 66%, #21c0d1 100%);
      color:#fff;
      border:none;
      border-radius:7px;
      padding:10px 28px;
      font-size:1em;
      cursor:pointer;
      transition:.21s;
    }
    #btn-next {background: #16b088;}
    #btn-replay {background: #e77c23;}
    .leaderboard {
      background: #f8f9fd;
      border-radius: 8px;
      padding: 10px 7px;
      margin:17px 0 6px;
      font-size: 1em;
      text-align: right;
    }
    .statsbox {
      display:flex;
      justify-content:space-between;
      gap:12px;
      background:#f2f6fd;
      padding:7px 12px;
      border-radius:7px;
    }
    .statsbox div {font-size:1em;}
    .fade {
      animation:fadeIn .6s;
    }
    @keyframes fadeIn {from {opacity:0;transform:scale(0.92);}to {opacity:1;transform:scale(1);}}
    @media (max-width:480px) {
      .container {max-width:98vw;padding:16px 2vw;}
      h1 {font-size:1.1em;}
      #quote{font-size:.97em;}
      #input{font-size:0.94em;}
    }
  </style>
</head>
<body>
<div class="container">
  <h1>لعبة الكتابة الاحترافية</h1>
  <div id="level"></div>
  <div id="quote"></div>
  <input id="input" type="text" placeholder="ابدأ بالكتابة هنا" disabled autocomplete="off">
  <div id="stats"></div>
  <div class="statsbox">
    <div id="timer"></div>
    <div id="score"></div>
  </div>
  <div id="result"></div>
  <button id="btn-start">ابدأ اللعبة</button>
  <button id="btn-next" style="display:none;">المستوى التالي</button>
  <button id="btn-replay" style="display:none;">إعادة المحاولة</button>
  <div class="leaderboard" id="leaderboard" style="display:none;">
    <strong>أفضل نتائجك (أعلى دقة وسرعة):</strong>
    <ol id="records"></ol>
  </div>
</div>
<script>
const levels = [
  // الصعوبة 1
  [
    "انطلق وحقق هدفك.",
    "الحلم بداية النجاح.",
    "جملة سهلة قصيرة.",
    "الأمل طريق التفوق.",
  ],
  // الصعوبة 2
  [
    "العقل السليم في الجسم السليم.",
    "ابدأ يومك بابتسامة ولا تيأس.",
    "الأصدقاء كنز لا يفنى أبداً.",
    "الرياضة مفيدة للصحة الجسدية والنفسية.",
  ],
  // الصعوبة 3
  [
    "النجاح يتطلب صبراً، ومثابرة، وعزيمة قوية.",
    "التكنولوجيا تفتح آفاقاً جديدة كل يوم، وتغير العالم بسرعة.",
    "الإبداع هو القدرة على رؤية ما لا يراه الآخرون.",
    "الحياة تجارب وخبرات نتعلم منها يوماً بعد يوم.",
  ],
  // الصعوبة 4
  [
    "هل يمكنك كتابة هذه الجملة دون أي أخطاء وفي أقل وقت ممكن؟",
    "الصبر مفتاح الفرج، لكن العمل مفتاح النجاح الحقيقي.",
    "في كل تحدٍ جديد نكتشف قدراتنا ونطور مهاراتنا الحياتية.",
    "القراءة تفتح أبواب العلم وتزيد المعرفة والثقافة.",
  ],
  // الصعوبة 5 (الأصعب)
  [
    "من يصر على تحقيق النجاح لن توقفه صعوبات الحياة، بل تكون دافعاً له نحو التألق والتفوق.",
    "الإبداع يحتاج إلى حرية التجربة والتكرار والتعلم من الأخطاء، مهما كانت بسيطة أو معقدة.",
    "التحدي الأكبر ليس في اجتياز العقبات، بل في البقاء ثابتاً في وجه الرياح وتخطي حدود نفسك.",
    "التعليم المستمر هو سلاح المستقبل، فهو يجدد الفكر ويطور المجتمع والإنسان.",
  ]
];

// إعدادات المستوى والزمن
const maxLevels = 5;
const baseTimes = [13, 17, 23, 28, 36]; // الزمن الأساسي لكل مستوى
let round, score, currQuote, currTime, timerInt, startTime, typingStats;
let records = JSON.parse(localStorage.getItem('typingProRecords')||'[]');

const quoteDiv = document.getElementById("quote"),
      input = document.getElementById("input"),
      timerDiv = document.getElementById("timer"),
      startBtn = document.getElementById("btn-start"),
      nextBtn  = document.getElementById("btn-next"),
      replayBtn = document.getElementById("btn-replay"),
      resultDiv = document.getElementById("result"),
      scoreDiv = document.getElementById("score"),
      leaderboard = document.getElementById("leaderboard"),
      recordsList = document.getElementById("records"),
      levelDiv = document.getElementById("level"),
      statsDiv = document.getElementById("stats");

function updateLeaderboard() {
  leaderboard.style.display=records.length?'block':'none';
  recordsList.innerHTML="";
  records.slice(0,3).forEach(rec=>{
    recordsList.innerHTML += "<li>النقاط: "+rec.score+
      ", أعلى دقة: "+rec.accuracy+"%، أسرع وقت: "+rec.time+"ث."+"</li>";
  });
}

function highlightErrors(inputText, quote) {
  let result = "";
  let errors = 0;
  let correct = 0;
  for (let i = 0; i < quote.length; i++) {
    if (inputText[i] === undefined) {
      result += "<span style='background:#ffeaea'>" + quote[i] + "</span>";
      errors++;
    } else if (inputText[i] === quote[i]) {
      result += "<span style='color:green'>" + quote[i] + "</span>";
      correct++;
    } else {
      result += "<span style='color:#ea6161;font-weight:bold'>" + quote[i] + "</span>";
      errors++;
    }
  }
  return {html: result, errors: errors, correct: correct};
}
function renderQuote(inputValue) {
  let show = highlightErrors(inputValue, currQuote);
  quoteDiv.innerHTML = show.html;
  // حساب الإحصائيات اللحظية
  let accuracy = Math.round(show.correct * 100 / currQuote.length);
  statsDiv.innerHTML = "دقة لحظية: "+accuracy+"% ، الأخطاء: "+show.errors;
  typingStats.accuracy=accuracy; typingStats.errors=show.errors; typingStats.correct=show.correct;
}

function startGame() {
  round = 0;
  score = 0;
  typingStats={accuracy:0, errors:0, correct:0, chars:0, time:0, speed:0};
  resultDiv.textContent="";
  startBtn.style.display="none";
  nextBtn.style.display="none";
  replayBtn.style.display="none";
  input.disabled=false; input.value=""; input.focus();
  scoreDiv.textContent="النقاط: 0";
  leaderboard.style.display="none";
  statsDiv.innerHTML="";
  document.body.style.background = "linear-gradient(135deg,#eef1fb 60%,#f8fbff 100%)";
  playRound();
}

function playRound() {
  round++;
  levelDiv.innerHTML="المستوى: "+round+" / "+maxLevels;
  let levelTexts = levels[Math.min(round-1,levels.length-1)];
  currQuote = levelTexts[Math.floor(Math.random()*levelTexts.length)];
  currTime = baseTimes[Math.min(round-1,baseTimes.length-1)];
  quoteDiv.innerHTML=currQuote;
  quoteDiv.classList.remove("fade");
  setTimeout(()=>{quoteDiv.classList.add("fade");},30)
  timerDiv.textContent = "الوقت: "+currTime+" ثانية";
  input.value="";
  input.disabled=false;
  input.focus();
  statsDiv.innerHTML="";
  typingStats.chars=currQuote.length;
  timerInt = setInterval(updateTimer, 100);
  startTime = new Date().getTime();
  document.body.style.background =
    ["#eef1fb","#f2f6fd","#f8fdff","#e7f3ff","#e8f2fc","#f7e5fc"]
    [Math.min(round-1,5)] + " 82%";
}
function updateTimer() {
  let now = new Date().getTime();
  let sec = currTime - ((now-startTime)/1000);
  timerDiv.textContent="الوقت: "+(sec>0?sec.toFixed(1):"0")+" ثانية";
  if(sec<=0)
    finishRound(false);
}
function finishRound(success) {
  clearInterval(timerInt); input.disabled=true;
  let usedTime = ((new Date().getTime() - startTime)/1000).toFixed(2);
  typingStats.time=usedTime;
  typingStats.speed = Math.round(currQuote.length * 60 / usedTime) || 0;
  let acc = typingStats.accuracy||0;
  let pts = 0;
  if(success && acc>85) {
    pts = Math.round(10 + acc + typingStats.speed);
    score += pts;
    scoreDiv.textContent="النقاط: "+score;
    resultDiv.innerHTML="<span style='color:green;font-weight:bold;'>رائع! النقاط: "+pts+"<br>الوقت: "+usedTime+"ث، الدقة: "+acc+"%، السرعة: "+typingStats.speed+" ح/د.</span>";
    resultDiv.classList.add("fade");
    if(round < maxLevels) nextBtn.style.display="inline-block";
    else finishGame(usedTime,true);
  } else if(success && acc<=85) {
    resultDiv.innerHTML="<span style='color:#e77c23;'>تمت كتابة الجملة لكن هناك أخطاء كثيرة.<br>الدقة: "+acc+"%.</span>";
    finishGame(usedTime,false);
  }
  else {
    resultDiv.innerHTML="<span style='color:#e77c23;'>انتهى الوقت أو هناك أخطاء في الكتابة.</span>";
    finishGame(usedTime,false);
  }
  statsDiv.innerHTML="دقة نهائية: "+acc+"%، الأخطاء: "+typingStats.errors+"، سرعة: "+typingStats.speed+" حرف/دقيقة";
}
function finishGame(finalTime,success) {
  input.disabled=true; nextBtn.style.display="none"; replayBtn.style.display="inline-block";
  leaderboard.style.display="block";
  records.unshift({
    score:score,
    accuracy:typingStats.accuracy,
    time:finalTime,
    speed:typingStats.speed
  });
  records = records.slice(0,5);
  localStorage.setItem('typingProRecords', JSON.stringify(records));
  updateLeaderboard();
  resultDiv.innerHTML += "<br><strong>المجموع النهائي: "+score+"</strong>";
}
input.addEventListener("input",()=> {
  renderQuote(input.value);
  if(input.value === currQuote)
    finishRound(true);
});
startBtn.addEventListener("click",startGame);
nextBtn.addEventListener("click",playRound);
replayBtn.addEventListener("click",startGame);
input.onpaste = e=>e.preventDefault();
input.oncopy = e=>e.preventDefault();
updateLeaderboard();
</script>
</body>
</html>
